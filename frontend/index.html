<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Analysis System</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto;">
                <button onclick="window.location.href='/'" class="btn btn-secondary" style="padding: 10px 20px;">
                    ‚Üê Back to Home
                </button>
                <div style="text-align: center; flex: 1;">
                    <h1>Voice Analysis System</h1>
                    <p>Upload or record audio to analyze emotion, vocal health, and more</p>
                </div>
                <div style="width: 140px;"></div> <!-- Spacer for centering -->
            </div>
        </header>

        <main>
            <!-- Upload Section -->
            <section class="upload-section">
                <div class="upload-card">
                    <div class="upload-icon">üé§</div>
                    <h2>Upload Audio File</h2>
                    <input type="file" id="fileInput" accept="audio/*" style="display: none;">
                    <button type="button" onclick="document.getElementById('fileInput').click()" class="btn btn-primary">
                        Choose File
                    </button>
                    <p class="file-info" id="fileInfo">No file selected</p>
                </div>

                <div class="divider">OR</div>

                <div class="record-card">
                    <div class="record-icon">üéôÔ∏è</div>
                    <h2>Record Audio</h2>
                    <button id="recordBtn" type="button" class="btn btn-secondary">
                        Start Recording
                    </button>
                    <p class="record-info" id="recordInfo">Click to start recording</p>
                    <div id="volumeMeter" style="display: none; margin-top: 15px;">
                        <label style="font-size: 0.9rem; color: #666; display: block; margin-bottom: 5px;">Microphone Level:</label>
                        <div style="width: 100%; height: 20px; background: #e0e0e0; border-radius: 10px; overflow: hidden;">
                            <div id="volumeBar" style="height: 100%; width: 0%; background: linear-gradient(90deg, #4CAF50, #FFC107, #F44336); transition: width 0.1s;"></div>
                        </div>
                        <p id="volumeText" style="font-size: 0.85rem; color: #666; margin-top: 5px;">Speak into the microphone...</p>
                    </div>
                </div>
            </section>

            <!-- Analysis Button -->
            <div class="analyze-section">
                <button id="analyzeBtn" type="button" class="btn btn-analyze" disabled>
                    Analyze Voice
                </button>
            </div>

            <!-- Loading Animation -->
            <div id="loadingSection" class="loading-section" style="display: none;">
                <div class="loading-container">
                    <div class="loading-spinner">
                        <div class="spinner-ring"></div>
                        <div class="spinner-ring"></div>
                        <div class="spinner-ring"></div>
                    </div>
                    <h3 class="loading-title">Analyzing Your Voice...</h3>
                    <div class="loading-steps">
                        <div class="loading-step" id="step1">
                            <div class="step-icon">üéµ</div>
                            <div class="step-text">Processing Audio</div>
                            <div class="step-status">‚è≥</div>
                        </div>
                        <div class="loading-step" id="step2">
                            <div class="step-icon">üé≠</div>
                            <div class="step-text">Detecting Emotions</div>
                            <div class="step-status">‚è≥</div>
                        </div>
                        <div class="loading-step" id="step3">
                            <div class="step-icon">üé§</div>
                            <div class="step-text">Analyzing Vocal Health</div>
                            <div class="step-status">‚è≥</div>
                        </div>
                        <div class="loading-step" id="step4">
                            <div class="step-icon">üíÜ</div>
                            <div class="step-text">Measuring Stress Levels</div>
                            <div class="step-status">‚è≥</div>
                        </div>
                        <div class="loading-step" id="step5">
                            <div class="step-icon">üß†</div>
                            <div class="step-text">Building Personality Profile</div>
                            <div class="step-status">‚è≥</div>
                        </div>
                    </div>
                    <div class="loading-progress">
                        <div class="progress-bar-loading">
                            <div id="progressFill" class="progress-fill-loading"></div>
                        </div>
                        <div class="progress-text"><span id="progressPercent">0</span>%</div>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <section id="resultsSection" class="results-section" style="display: none;">
                <div style="text-align: center; margin-bottom: 40px;">
                    <h2 style="font-size: 2.5rem; background: linear-gradient(135deg, #667eea, #f093fb); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 10px;">‚ú® Analysis Complete</h2>
                    <p style="color: rgba(255, 255, 255, 0.7); font-size: 1.1rem;">Here's what we discovered about your voice</p>
                </div>

                <!-- Quality Warning -->
                <div id="qualityWarning" class="quality-warning" style="display: none;">
                    <div style="display: flex; align-items: start; gap: 10px;">
                        <span style="font-size: 24px;">‚ö†Ô∏è</span>
                        <div style="flex: 1;">
                            <h3 style="margin: 0 0 8px 0; color: #f093fb; font-weight: 600;">Analysis Quality Issues Detected</h3>
                            <ul id="qualityIssues" style="margin: 0; padding-left: 20px; color: rgba(255, 255, 255, 0.7);">
                            </ul>
                            <p style="margin: 10px 0 0 0; font-size: 0.9rem; color: rgba(255, 255, 255, 0.6);">
                                <strong style="color: rgba(255, 255, 255, 0.8);">üí° Tips for better results:</strong> Record for at least 5 seconds, speak clearly and naturally, ensure good microphone volume.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üòä</div>
                        <div class="stat-label">Emotion</div>
                        <div class="stat-value" id="emotionValue">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚ù§Ô∏è</div>
                        <div class="stat-label">Vocal Health</div>
                        <div class="stat-value" id="healthValue">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üò∞</div>
                        <div class="stat-label">Stress Level</div>
                        <div class="stat-value" id="stressValue">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è±Ô∏è</div>
                        <div class="stat-label">Duration</div>
                        <div class="stat-value" id="durationValue">-</div>
                    </div>
                </div>

                <!-- Export Button -->
                <div style="text-align: right; margin-bottom: 20px;">
                    <button id="exportPdfBtn" class="btn btn-primary" style="padding: 12px 30px; display: inline-flex; align-items: center; gap: 10px;">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M13 8V2H7v6H2l8 8 8-8h-5zM0 18h20v2H0v-2z"/>
                        </svg>
                        Export Report as PDF
                    </button>
                </div>

                <!-- Charts Section -->
                <div class="charts-section">
                    <div class="chart-card">
                        <h3>üìä Emotion Distribution</h3>
                        <canvas id="emotionChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>üí™ Stress Breakdown</h3>
                        <canvas id="stressChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>üéµ Voice Pitch Analysis</h3>
                        <canvas id="pitchChart"></canvas>
                    </div>
                </div>

                <!-- Detailed Results -->
                <div class="details-grid">
                    <!-- Personality Analysis -->
                    <div class="detail-card personality-card">
                        <h3>üß† Personality Traits</h3>
                        <div class="chart-wrapper">
                            <canvas id="personalityChart"></canvas>
                        </div>
                    </div>

                    <!-- Issues Detected -->
                    <div class="detail-card">
                        <h3>‚ö†Ô∏è Issues Detected</h3>
                        <div id="issuesContent" class="content">
                            <ul id="issuesList"></ul>
                        </div>
                    </div>

                    <!-- Suggestions -->
                    <div class="detail-card">
                        <h3>üí° Suggestions</h3>
                        <div id="suggestionsContent" class="content">
                            <ul id="suggestionsList"></ul>
                        </div>
                    </div>

                    <!-- Early Illness Signals -->
                    <div class="detail-card">
                        <h3>üè• Health Signals</h3>
                        <div id="illnessContent" class="content">
                            <ul id="illnessList"></ul>
                        </div>
                    </div>

                    <!-- Timeline -->
                    <div class="detail-card full-width">
                        <h3>üìà Emotion Timeline</h3>
                        <div class="chart-wrapper-timeline">
                            <canvas id="timelineChart"></canvas>
                        </div>
                    </div>

                    <!-- Emotion Heatmap -->
                    <div class="detail-card full-width">
                        <h3>üî• Emotion Confidence Heatmap</h3>
                        <div id="heatmapContent" class="heatmap-container"></div>
                    </div>
                </div>

                <!-- Raw Data (Collapsible) -->
                <details class="raw-data">
                    <summary>View Raw Data</summary>
                    <pre id="rawData"></pre>
                </details>
            </section>
        </main>

        <footer>
            <p>Voice Analysis System v1.0 | Powered by AI</p>
        </footer>
    </div>

    <!-- Floating AI Assistant -->
    <div id="chatbotWidget" class="chatbot-widget">
        <button id="chatbotToggle" class="chatbot-toggle">
            <svg class="chat-icon" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12c0 1.54.36 3 .97 4.29L2 22l5.71-.97C9 21.64 10.46 22 12 22c5.52 0 10-4.48 10-10S17.52 2 12 2zm0 18c-1.38 0-2.68-.3-3.86-.84l-.27-.15-2.86.49.49-2.86-.15-.27C4.3 14.68 4 13.38 4 12c0-4.41 3.59-8 8-8s8 3.59 8 8-3.59 8-8 8z"/>
                <circle cx="9" cy="12" r="1"/>
                <circle cx="12" cy="12" r="1"/>
                <circle cx="15" cy="12" r="1"/>
            </svg>
            <svg class="close-icon" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
            <div class="notification-badge" id="chatNotification">1</div>
        </button>
        
        <div id="chatbotPanel" class="chatbot-panel">
            <div class="chatbot-header">
                <div class="header-info">
                    <div class="bot-avatar">ü§ñ</div>
                    <div>
                        <h4>AI Assistant</h4>
                        <span class="status-indicator">‚óè Online</span>
                    </div>
                </div>
                <button id="minimizeChat" class="minimize-btn">_</button>
            </div>
            
            <div id="chatMessages" class="chat-messages">
                <div class="chat-message bot-message">
                    <div class="message-icon">ü§ñ</div>
                    <div class="message-content">
                        <p>Hi! I'm your AI voice analysis assistant. Ask me anything about your results!</p>
                        <p class="message-suggestions">Try asking:</p>
                        <ul class="quick-questions">
                            <li onclick="askQuestion('What emotion was detected?')">What emotion was detected?</li>
                            <li onclick="askQuestion('How is my vocal health?')">How is my vocal health?</li>
                            <li onclick="askQuestion('What is my stress level?')">What is my stress level?</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="chat-input-container">
                <input type="text" id="chatInput" class="chat-input" placeholder="Ask me anything..." />
                <button id="chatSendBtn" class="chat-send-btn">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M2 10L18 2L10 18L8 11L2 10Z" fill="currentColor"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script type="importmap">
    {
      "imports": {
        "@google/generative-ai": "https://esm.run/@google/generative-ai"
      }
    }
    </script>
    <!-- Link the script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script type="module" src="script.js?v=20251119-0100"></script>
</body>
</html>
